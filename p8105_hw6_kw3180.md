p8105_hw6_kw3180
================
Kino Watanabe
2025-11-28

# Problem 2

### Load the data

``` r
library(modelr)
library(p8105.datasets)
data("weather_df") 

weather_df <- weather_df |> 
  filter(name == "CentralPark_NY")
```

What do the distribution of variables prcp and tmin look like?

``` r
weather_df |> 
  ggplot(aes(x = tmin, y = tmax)) + 
  geom_point() 
```

<img src="p8105_hw6_kw3180_files/figure-gfm/unnamed-chunk-3-1.png" width="90%" />

``` r
weather_df |> 
  ggplot(aes(x = prcp, y = tmax)) + 
  geom_point() 
```

<img src="p8105_hw6_kw3180_files/figure-gfm/unnamed-chunk-3-2.png" width="90%" />

### Let’s do bootstrapping

``` r
set.seed(1)

bootstrap_results = 
  weather_df |> 
  bootstrap(n = 5000) |> 
  mutate(
    df = map(strap, as_tibble),
    fits = map(df, \(df) lm(tmax ~ tmin + prcp, data = df)),
    coefs = map(fits, broom::tidy),
    rsquare = map(fits, broom::glance)
  ) |> 
  select(.id, coefs, rsquare) 


coefs_tibble <- bootstrap_results |> 
  unnest(coefs) |> 
  select(.id, term, estimate) |> 
  pivot_wider(
    names_from = term, 
    values_from = estimate) |> 
  mutate(beta_slope = tmin / prcp)


rsquare_tibble <- bootstrap_results |> 
  unnest(rsquare) |> 
  select(.id, r.squared, adj.r.squared)

bootstrap_results_merged <- 
  left_join(coefs_tibble, rsquare_tibble, by = ".id")


bootstrap_results_merged
```

    ## # A tibble: 5,000 × 7
    ##    .id   `(Intercept)`  tmin      prcp beta_slope r.squared adj.r.squared
    ##    <chr>         <dbl> <dbl>     <dbl>      <dbl>     <dbl>         <dbl>
    ##  1 0001           7.63  1.04 -0.00439       -237.     0.913         0.913
    ##  2 0002           7.56  1.04 -0.00245       -424.     0.921         0.920
    ##  3 0003           7.61  1.03 -0.000690     -1492.     0.905         0.905
    ##  4 0004           7.27  1.06 -0.00290       -364.     0.921         0.921
    ##  5 0005           7.79  1.02 -0.00222       -461.     0.906         0.905
    ##  6 0006           7.54  1.04 -0.00164       -634.     0.915         0.915
    ##  7 0007           7.50  1.04 -0.00129       -808.     0.919         0.919
    ##  8 0008           7.54  1.04 -0.000428     -2435.     0.905         0.905
    ##  9 0009           7.59  1.05 -0.00145       -723.     0.917         0.917
    ## 10 0010           7.36  1.04 -0.00303       -344.     0.916         0.915
    ## # ℹ 4,990 more rows

### Plot the distribution after bootstrapping

``` r
# r² distribution
rsquare_plot <- bootstrap_results_merged |> 
  ggplot(aes(x = r.squared)) +
  geom_density() +
  labs(
    x = "R-square hat estimates",
    y = "Density",
    title = "Bootstrap Distribution of r² hat")

rsquare_plot
```

<img src="p8105_hw6_kw3180_files/figure-gfm/unnamed-chunk-5-1.png" width="90%" />

``` r
# β¹ ÷ β² distribution
slope_plot <- bootstrap_results_merged |> 
  ggplot(aes(x = beta_slope)) +
  geom_density() +
  labs(
    x = "β1 hat/ β2 hat estimates",
    y = "Density",
    title = "Bootstrap Distribution of β1 hat/ β2 hat")

slope_plot
```

<img src="p8105_hw6_kw3180_files/figure-gfm/unnamed-chunk-5-2.png" width="90%" />

- The r-square is generally normally distributed after bootstrapping,
  but the distribution of r-squares are still slightly left skewed.

- The 95% CI for the proportion of variance in Central Park’s tmax that
  is explained by predictors tmin and prcp is between 0.89 and 0.93.

- The distribution after bootstrapping for β1 hat/ β2 hat is extremely
  skewed to the left, and the wide distribution is reflected in its
  large 95% CI = (-5616.45, 4586.92). his occurs because the beta
  coefficient for prcp is close to 0, while the beta coefficient for
  tmin is close to 1. Small differences in beta 2 (prcp) lead to large
  changes in the slope ratio, making the estimate unstable.
  Additionally, precipitation shows outliers and does not appear to have
  a meaningful linear association with tmax, further contributing to
  variability in its estimated coefficient and instability in the ratio.

### 95% CI

``` r
bootstrap_results_merged |> 
  summarize(
    r2_ci_lower = quantile(r.squared, 0.025),
    r2_ci_upper = quantile(r.squared, 0.975),
    beta_ci_lower = quantile(beta_slope, 0.025),
    beta_ci_upper = quantile(beta_slope, 0.975)
  )
```

    ## # A tibble: 1 × 4
    ##   r2_ci_lower r2_ci_upper beta_ci_lower beta_ci_upper
    ##         <dbl>       <dbl>         <dbl>         <dbl>
    ## 1       0.894       0.928        -5616.         4587.
